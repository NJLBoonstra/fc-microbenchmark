# fc-microbenchmark

A micro-benchmark for the Firecracker virtual machine monitor. It is able to generate workload descriptions, execute the workloads and process the results. The benchmark is designed in  such a way, that users can easily add more test programs.


## Getting Started

### Setting up the machine
In order for the benchmark to function properly, you need several packages. These packages can be installed automatically on Ubuntu systems by calling `prepare-ubuntu.sh`. This fetches the packages necessary to set-up KVM, a Python `pipenv` and installs packages to turn off Simultaneous Multi Threading (SMT).

If you wish to do this manually, please install the following packages:
- `qemu-kvm`
- python3.7, or higher
- `pip` for python3.7
   - `pipenv` installed via pip
- `linux-tools-common`
- `linux-cloud-tools`

Add your user to the KVM group as follows:
`sudo usermod -aG kvm $USER`

### Setting-up the benchmark

All set-up can be done automatically by running the `setup.sh` script from a terminal. This scripts handles the creation of a root filesystem (rootfs), based on the [Alpine Linux mini root filesystem](https://alpinelinux.org/downloads/), to which it adds some custom init scripts to facilitate the benchmark. The set-up script also creates the write disk, which is needed for all I/O, as the root filesystem is mounted as read-only by the benchmark.

Another important aspect handled by the benchmark is fetching the (currently supported) Firecracker binary. The binary for your architecture will be downloaded by the script and placed in the `~/bin` directory. NOTE: the `~/bin` directory *must* be in PATH!

The set-up script does currently not support building a Linux kernel from the source. For this reason, we currently provide two kernels: a x86_64 kernel and a aarch64 kernel. If you wish to build your own custom kernel, please follow the instructions provided by the Firecracker team: https://github.com/firecracker-microvm/firecracker/blob/master/docs/rootfs-and-kernel-setup.md.

### Creating workloads

Before we can run the benchmark, it is necessary to have workload descriptions, which the benchmark executes. By convention, these workloads are placed in the `./workloads` directory. The workloads may be generated by using the workload generator, also located in the `./workloads` directory. If you wish to create workloads, we refer to the README of the workload generator: <link to README of workload generator>

TODO: extend
